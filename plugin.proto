syntax = "proto3";
package plugins;
option go_package = "./plugin";

// Base plugin routes. These must be implemented by
// all kytheron plugins
service Plugin {
  rpc GetMetadata(Empty) returns (Metadata);
  rpc Configure(ConfigureRequest) returns (ConfigureResponse);
}
// Source plugin is a client, that initiates streaming with the
// Kytheron server
 // Source Plugin - handles reading logs from various sources
service SourcePlugin {
  rpc StreamLogs(stream RawLog) returns (Empty);
}

// Parser plugin is a server, and responds to requests from Kytheron
// Parser Plugin - handles parsing different log formats
service ParserPlugin {
  rpc ParseLog(RawLog) returns (stream ParsedLog);
}

// Output plugin is a server, and responds to requests from Kytheron
 // Output Plugin - handles evaluation outputs
service OutputPlugin {
  rpc Proc(EvaluationRequest) returns (EvaluationResponse);
}

message Metadata {
  string name = 1;
  string version = 2;
  repeated string types = 3;
}

message Empty {}

message ConfigureRequest {
  map<string, string> config = 1;
}

message ConfigureResponse {
  bool success = 1;
  string error = 2;
}

message ReadLogsRequest {
  map<string, string> params = 1; // e.g., {"path": "/var/log/app.log"}
}

message RawLog {
  string id = 1;
  string data = 2;
  map<string, string> metadata = 3; // source info, timestamps, etc.
}

message ParsedLog {
  string id = 1;
  string source_id = 2;
  string source_type = 3;
  string source_name = 4;
  string data = 5; // JSON formatted
  bool success = 6;
  string error = 7;
}

message EvaluationRequest {
  repeated ParsedLog logs = 1;
  string policy_name = 2;
}

message EvaluationResponse {

}